---
title: "GitLab CI × Slack Webhook 2023 | 0. Freeze-Free MR Pipeline 설계"
contribution : 100%
date: 2025-01-25 01:00:00 +09:00
categories: [DevOps, CI-CD]
tags: [
  gitlab-ci, slack-webhook, merge-request,
  pipeline, bash, alerting, predefined-variables
]

---


## 1. 문제 상황 또는 동기 (Motivation)
- 프로젝트 프리징 기간에 MR이 실수로 머지되어 소스가 반영되는 일이 발생
- 배포 안정성 확보와 휴먼에러 방지를 위해 자동화된 차단 장치 필요성 인식
- CI/CD, .gitlab-ci.yml, bash 등 익숙하지 않은 환경에서의 자동화 도입에 대한 도전

---

## 2. 목표 및 요구사항 (Goal & Requirements)
- 프리징 기간에 MR이 머지되는 것을 사전에 차단 (자동화)
- Slack Webhook을 통한 실시간 알림 연동
- 차단 시점(MR 전/후) 명확화 및 유연한 조건 분기
- GitLab CI/CD 변수, bash 스크립트, GitLab Predefined Variables 적극 활용

---

## 3. 구현 과정 (Implementation)
### 3.1 주요 코드/로직 설명
- Slack Webhook 신청 및 테스트, 실제로 Slack 채널에 메시지가 오는지 curl로 사전 검증
- .gitlab-ci.yml 작성 및 GitLab Settings > CI/CD > Variables에서 FREEZE, SLACK_WEBHOOK_URL 등 변수 세팅
- MR 이벤트 감지 및 조건 분기, Slack 알림 전송, 파이프라인 차단 등 구현


#### GitLab CI/CD Workflow
![GitLab CI/CD Workflow](https://workshop.infograb.io/gitlab-ci/images/1/gitlab_ci_cd_workflow.png)

### 3.2 시행착오/트러블슈팅
- GitLab Workflow와 CI/CD 개념 혼동, .gitlab-ci.yml 문법 미숙으로 인한 반복적인 에러
- GitLab Predefined Variables 사용법, MR 이벤트 감지 조건(rules, only 등) 시행착오
- bash 문법, Slack Webhook 메시지 특수문자 처리 등에서 반복적인 에러 경험
- 특히, curl 명령어에서 변수와 특수문자, 이모지, 줄바꿈 처리 등으로 인해 예상치 못한 에러가 자주 발생
- MR 생성이 트리거가 되어야 하므로, 배치형식이 아닌 상시성 파이프라인 설계의 어려움

> 해당 작업도 다른 작업들처럼 배치형식으로 일정한 주기를 가지고 할 수 있는 것이었으면 작업이 편했을 것 같으나, 이 작업은 사람이 MR을 생성 했을시, 수행되어야하기에 MR이 생성된 시점에서 수행되어야 했습니다. 그래서 상시성을 갖고 있어야한다는 점이 서러웠습니다. 그 외에도 bash 작성 때 만난 Nested Mapping Error, collapse multi line command 등등 많은 트러블이 있었습니다.

<img src="/assets/img/2025-01-25/2025-01-25-GITLAB_CI_0_3.png" alt="트러블슈팅 과정2" style="width: 350px; max-width: 100%;" />
<img src="/assets/img/2025-01-25/2025-01-25-GITLAB_CI_0_5.png" alt="트러블슈팅 과정4" style="width: 350px; max-width: 100%;" />

---

## 4. 결과 및 느낀 점 (Result & Retrospective)
- 휴먼에러로 인한 소스 반영 방지, 리소스 낭비 감소, 테스트 환경 개선
- 실제로 프리징 기간 중 MR이 차단되고, Slack으로 즉시 알림이 도착하는 것을 확인
- CI/CD 자동화 경험 및 bash, GitLab 변수 활용 능력 향상
- 상시성 파이프라인 설계와 bash 스크립트 작성에 대한 자신감 획득

---

## 5. 참고 자료 (References)
- [GitLab CI/CD 공식 문서](https://docs.gitlab.com/ee/ci/)
- [Slack Webhook 공식 문서](https://api.slack.com/messaging/webhooks)
- [깃랩 워크플로우 이미지 출처](https://workshop.infograb.io/gitlab-ci/11_introduction-to-gitlab-cicd/2_gitlab_ci_cd_workflow/)
- [깃허브 PR eslint 예제](https://marshallku.com/web/tips/pull-request%EB%A5%BC-%EB%B3%91%ED%95%A9%ED%95%98%EA%B8%B0-%EC%A0%84%EC%97%90-%EC%BD%94%EB%93%9C-%EA%B2%80%EC%82%AC%ED%95%98%EA%B8%B0)

---
