---
title: GitLab CI Ã— Slack Webhook | 2. Freeze-Window ì°¨ë‹¨Â·MR ì•Œë¦¼Â·ì™¸ë¶€ Include ìë™í™”
contribution: 100
date: 2023-08-20 01:00:00 +09:00
lastmod: 2025-09-21 14:30:00 +0900
start_date: 2023-08-09
end_date: 2023-08-16
categories: [DevOps, CI-CD]
tags: [
  gitlab-ci, slack-webhook, merge-request, external-include, pipeline, bash,
  alerting, predefined-variables
]
---

> ğŸ“Œ ì´ ê¸€ì€ **GitLab CI Ã— Slack Webhook** ì¤‘ 2í¸ì…ë‹ˆë‹¤.  
> 1í¸: [Freeze-Free MR Pipeline ì„¤ê³„](/posts/gitlab_ci_0)  
> 3í¸: [ì‚¬ìš©ìë³„ í”„ë¡œí•„ ì´ëª¨ì§€ ë§ì¶¤ ì ìš©](/posts/gitlab_ci_2)  
> 4í¸: [ê°€ì´ë“œ- MR ì•Œë¦¼Â·Draft í† ê¸€Â·ì¶©ëŒ ê°ì§€](/posts/gitlab_ci_2024)

---

## ë„ì… ë° ë°°ê²½

ì—¬ëŸ¬ í”„ë¡œì íŠ¸ì—ì„œ GitLab CIë¥¼ ìš´ì˜í•˜ë‹¤ ë³´ë©´, ë°°í¬ ì•ˆì •ì„±ì„ ìœ„í•´ í”„ë¦¬ì§• ê¸°ê°„ ë™ì•ˆ release ë¸Œëœì¹˜ë¡œì˜ ë¨¸ì§€ë¥¼ ë§‰ê±°ë‚˜, master ë¸Œëœì¹˜ë¡œì˜ ì‹¤ìˆ˜ ë¨¸ì§€ë¥¼ ë°©ì§€í•´ì•¼ í•  ë•Œê°€ ë§ìŠµë‹ˆë‹¤. ë˜í•œ MR ìƒì„± ì‹œ íŒ€ì›ë“¤ì—ê²Œ ìŠ¬ë™ ì•Œë¦¼ì„ ìë™ìœ¼ë¡œ ë³´ë‚´ê³ , ì—¬ëŸ¬ í”„ë¡œì íŠ¸ì˜ CIë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì™¸ë¶€ ì°¸ì¡° ë°©ì‹ë„ í•„ìš”í•©ë‹ˆë‹¤.

---

## ì ìš© ë°©ë²• ë° í”„ë¡œì„¸ìŠ¤

1. GitLab ë ˆí¬ì§€í† ë¦¬ > Settings > CI/CD > Variablesì—ì„œ ë³€ìˆ˜ë¥¼ ì„ ì–¸í•©ë‹ˆë‹¤. (SLACK_URL, F_S_DATE, F_E_DATE)
  - ë‚ ì§œ í˜•ì‹ì€ ë¸Œëœì¹˜ ë‚ ì§œ í˜•ì‹ê³¼ ë§ì¶¥ë‹ˆë‹¤. (yymmdd)
2. feature-****ê³¼ ê°™ì€ í”¼ì²˜ ë¸Œëœì¹˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
3. ìƒì„±í•œ ë¸Œëœì¹˜ì˜ .gitlab-ci.ymlì— ì•„ë˜ ì˜ˆì‹œ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
4. ì»¤ë°‹ í›„ release ë¸Œëœì¹˜ì— ë¨¸ì§€í•©ë‹ˆë‹¤.
5. release ë¸Œëœì¹˜ê°€ ìƒìš© ë°°í¬ëœ í›„ master ë¸Œëœì¹˜ì— ë¨¸ì§€í•˜ë©´ ì™„ë£Œë©ë‹ˆë‹¤.

> **ì°¸ê³ :** ì´ í”„ë¡œì„¸ìŠ¤ëŠ” MR ìƒì„± ì‹œ, íƒ€ê²Ÿ ë¸Œëœì¹˜(release)ê°€ ì•„ë‹Œ ì†ŒìŠ¤ ë¸Œëœì¹˜(feature)ì— ì‘ì„±ëœ .`gitlab-ci.yml`{: .filepath }ì„ ê¸°ì¤€ìœ¼ë¡œ íŒŒì´í”„ë¼ì¸ì´ ì‘ë™í•©ë‹ˆë‹¤.
{: .prompt-tip }

í”„ë¦¬ì§• ê¸°ê°„ ì˜ˆì‹œ: **07/18(í™”) ìš´ì˜ ë°°í¬ ì´í›„ ~ 07/28(ê¸ˆ)**  
ë°°í¬ì˜ˆì •: **08/01(í™”)**  
â†’ 230718, 230728 ë“±ìœ¼ë¡œ ë³€ìˆ˜ ì„¸íŒ…. ë°°í¬ ë¸Œëœì¹˜ê°€ release-230801-1ì´ë©´, í”„ë¦¬ì§• ê¸°ê°„ ë‚´ì˜ ë‹¤ë¥¸ release ë¸Œëœì¹˜(ex. release-230720-1)ëŠ” Merge ë°©ì§€ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‘í•©ë‹ˆë‹¤.

---

## MR ìƒì„± ì•Œë¦¼ & master ë¸Œëœì¹˜ Merge ë°©ì§€ ê¸°ëŠ¥

í”„ë¦¬ì§• ë°©ì§€ í”„ë¡œì„¸ìŠ¤ë¥¼ ë„ì…í•œ í›„, ì‹¤ìˆ˜ë¡œ feature â†’ master MRì´ ìƒì„±ë˜ëŠ” ì‚¬ë¡€ê°€ ìˆì–´ master merge ì°¨ë‹¨ ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ë˜í•œ MR ìŠ¹ì¸ ìš”ì²­ì„ ìŠ¬ë™ìœ¼ë¡œ ìë™ ì•Œë¦¼í•˜ëŠ” ê¸°ëŠ¥ë„ í•¨ê»˜ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

---

## ì™¸ë¶€ì°¸ì¡° ì„¤ì • ë° ë¦¬íŒ©í† ë§

ì—¬ëŸ¬ í”„ë¡œì íŠ¸ì—ì„œ í•˜ë‚˜ì˜ ê³µí†µ CI ì†ŒìŠ¤ë¥¼ ì™¸ë¶€ì°¸ì¡° ë°©ì‹ìœ¼ë¡œ ê´€ë¦¬í•˜ë©´, ìœ ì§€ë³´ìˆ˜ì™€ ê´€ë¦¬ê°€ í›¨ì”¬ ìš©ì´í•´ì§‘ë‹ˆë‹¤.  
ì—¬ëŸ¬ jobì„ í•˜ë‚˜ë¡œ ë¦¬íŒ©í† ë§í•˜ë©´ì„œ ë™ì‘ ìˆœì„œì™€ ì¤‘ë³µ ë¡œì§ì„ ìµœì í™”í•´ ì„±ëŠ¥ë„ í–¥ìƒë©ë‹ˆë‹¤.

---


## ê¸°ëŠ¥ë³„ ì½”ë“œ ì˜ˆì‹œ

### 1. ì™¸ë¶€ ì°¸ì¡° ì„¤ì • ì½”ë“œ
```yaml
include:
  - project: "ê³µí†µê´€ë¦¬í”„ë¡œì íŠ¸ëª…"
    ref: master
    file: ".gitlab-ci.yml"
```

### 2. ê³µí†µ ë³€ìˆ˜ ì„ ì–¸
```yaml
variables:
  TB: ${CI_MERGE_REQUEST_TARGET_BRANCH_NAME}
  SB: ${CI_MERGE_REQUEST_SOURCE_BRANCH_NAME}
```

### 3. MR ìƒì„± ì•Œë¦¼
```yaml
mr_machine:
  stage: build
  script: |
    if [ ${TB} == "develop" ]; then
      curl -X POST -H "Content-type: application/json" --data "{\"username\": \"${GITLAB_USER_NAME}\", \"text\":\"dev MR ìŠ¹ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤! ${CI_MERGE_REQUEST_PROJECT_URL}/-/merge_requests/${CI_MERGE_REQUEST_IID}\", \"icon_emoji\": \":bust_in_silhouette:\"}" $SLACK_URL
    elif [ ${TB:0:7} == "release" ]; then
      curl -X POST -H "Content-type: application/json" --data "{\"username\": \"${GITLAB_USER_NAME}\", \"text\":\"release MR ìŠ¹ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤! ${CI_MERGE_REQUEST_PROJECT_URL}/-/merge_requests/${CI_MERGE_REQUEST_IID}\", \"icon_emoji\": \":bust_in_silhouette:\"}" $SLACK_URL
    fi
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
```

### 4. í”„ë¦¬ì§• ê¸°ê°„ Merge ì°¨ë‹¨
```yaml
freezing_alarm:
  stage: build
  script: |
    if [ ${TB:0:7} == "release" ] && [ ${TB:8:6} \> $F_S_DATE ] && [ ${TB:8:6} \< $F_E_DATE ]; then
      curl -X POST -H "Content-type: application/json" --data "{\"channel\": \"#channel\", \"username\": \"í”„ë¦¬ì§•ë°©ë²”ëŒ€\", \"text\":\"<!here> í”„ë¦¬ì§• ê¸°ê°„ ìœ„ë°˜! ${SB} -> ${TB}\", \"icon_emoji\": \":ice_cube:\"}" $SLACK_URL
      exit -1
    fi
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
```

### 5. master ë¸Œëœì¹˜ Merge ì°¨ë‹¨
```yaml
master_merge_inspector:
  stage: build
  script: |
    if [ ${TB} == "master" ] && [ ${SB:0:7} == "feature" ]; then
      curl -X POST -H "Content-type: application/json" --data "{\"username\": \"ë§ˆìŠ¤í„°ìˆ˜í˜¸ì\", \"text\":\"<!here> master merge ë°œê²¬! ${SB} -> ${TB}\", \"icon_emoji\": \":judge:\"}" $SLACK_URL
      exit -1
    fi
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
```

---

![image.png](/assets/img/2025-01-25/2025-01-25-gitlab_ci_1_1.png)
![image.png](/assets/img/2025-01-25/2025-01-25-gitlab_ci_1_2.png)


---