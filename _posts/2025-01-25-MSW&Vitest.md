---
title: MSW 노드 환경 도입 및 Vitest 테스트 환경 세팅
date: 2025-01-25 01:00:00 +09:00
categories: [Frontend, MSW]
tags: [MSW, Vue.js, Vitest, TestCode]
---
# MSW(Mock Service Worker)(2024) (1)

***jest***-environment-jsdom 

[https://velog.io/@ghenmaru/jest-msw-jest-msw-적용-안되는-문제-해결](https://velog.io/@ghenmaru/jest-msw-jest-msw-%EC%A0%81%EC%9A%A9-%EC%95%88%EB%90%98%EB%8A%94-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0)

![image.png](/assets/img/2025-01-25/2025-01-25-MSW&Vitest_1.png)

![image.png](/assets/img/2025-01-25/2025-01-25-MSW&Vitest_2.png)

![image.png](/assets/img/2025-01-25/2025-01-25-MSW&Vitest_3.png)


**해당 티켓은 브레인 스토밍 과정 중에 있음**

**목적** : 프론트엔드 프로젝트에서의 테스트 환경 조성을 통한 개발자 스스로의 코드 정확성 확보 및 유지, 보수 시 용이함을 얻기 위함

**1. 1차원적 목표**

통합테스트 환경 조성

**2. 차후 목표, 상세 목표**

1. 통합테스트 환경 조성 후 노드환경에서의 MSW를 개발 및 활용한 테스트 코드 작성
2. 통합테스트 환경이 어느 정도 조성됐다면, 일부 항목에 대해 단위 테스트 환경 조성

**3. 우선과제**

1. 통합테스트 환경 조성을 위한 참고자료 조사
2. 테스트 도구 결정
3. 테스트 범위 결정
4. 테스트 작성 양식 결정
5. 대상 프로젝트(MO) 내에서 어느 곳부터 시험삼아 시도해볼 것인가(html_01, 기획전, 패션인피니티)

**참고 문헌** :

- [https://toss.tech/article/firesidechat_frontend_3](https://toss.tech/article/firesidechat_frontend_3)
- [https://velog.io/@couchcoding/](https://velog.io/@couchcoding/)프론트엔드-테스트-어떻게-해야할까with-react-testing-library
- [https://developer-bandi.github.io/post/frontend-testing/](https://developer-bandi.github.io/post/frontend-testing/)
- [https://techblog.woowahan.com/19509/](https://techblog.woowahan.com/19509/)
- -----------------------------------------------------------------------------------------------

**어떤 경우에 테스트 코드를 작성하는가**

퍼널(Funnel) : 사용자에게 복잡한 값을 입력받을 때, 여러 화면이나 단계로 쪼개어서 입력받는 흐름

퍼널 테스트 혹은 의존성이 다양한 스펙이 있을 때

- 테스트 케이스가 굉장히 복잡하고 개수가 많고 혹은 테스트를 하기 위한 환경이 복잡하고 마련하기 어렵고
- 그래서 피드백 사이클이 긴 경우에 그걸 좁히기 위해서 흔히 말하는 TDD 기반의 테스트 코드를 작성하면서
- 조금씩 스펙을 완성해내는 코드를 작성을 하는 것 같다!

**주로 페이지 단위의 통합(Integration) 테스트를 작성한다.**

- 사용자 관점에서 동작을 테스트하는 코드들이 많고, 오히려 더 복잡하고 의존성이 많은 경우를 테스트하는 케이스가 많은 것 같다.(ex. html_01, 기획전)

**어떤 경우에 테스트 코드를 작성하지 않는가**

1. 너무 간단한 경우
2. 일주일 뒤에 없어질 수 있을지 않을지 모르는 경우
3. 테스트하기 너무 손쉬운 경우(ex. 분기가 하나인 경우)

**테스트 코드를 작성하는 전략**

기능적 테스트와 시각적 테스트 두가지에 대해서 살펴보았습니다. 이제 테스트 코드를 작성하는 몇가지 방법에 대해서는 이해하였을것입니다. 이제 남은것은 이 방법을 언제 쓰는것이 좋을지 살펴보는것입니다. 이번 섹션에서는 테스트 코드를 어떤 전략을 가지고 적용하면 좋을지 알아보겠습니다.

기능적 테스트의 경우 먼저 통합테스트를 작성하고 이후 단위테스트나 E2E 테스트를 작성해보는것이 좋습니다. 페이지나 특정 영역을 대상으로 사용자 시나리오를 바탕으로한 통합테스트를 작성해 최소한의 프론트엔드 무결성을 보증해주는것입니다.

통합테스트를 진행하면서 어느정도 중요성이 있는 페이지이거나 자주 사용되는 컴포넌트등을 발견하는경우 단위 테스트를 작성하는것이 좋습니다. 사실 통합테스트를 통해 단위 테스트의 대상인 유틸함수나 컴포넌트등도 모두 검증이 되기에 단위테스트가 굳이 필요하지 않다고 생각할수 있는데, 단위테스트를 작성함으로써 문제가 발생했을때 원인을 찾기위한 범위를 줄일수 있다는 장점이 있습니다.

E2E 테스트의 경우 앞서 언급한것 처럼 QA팀의 유무에 따라 달리 적용하는것이 좋습니다. QA팀이 없는 경우 E2E 테스트 코드를 짜되 비용이 많이 드는 테스트 방법이므로 비즈니스적으로 문제가 발생할시 큰 문제가 발생하는 영역에 대해서 적용해두는것이 좋습니다. 일반적으로 전체 비율의 10%를 넘어가지 않는 선에서 적용하면 유지보수를 하는데 문제가 없습니다.

시각적 테스트의 경우 기능 테스트에 비해 비용이 크고 필수적인 내용을 검증하는것이 아니기 때문에 시각적 요소가 매우 중요한 페이지에 한하여 적용하는것이 좋습니다. 가령 사내에서 사용되는 어드민 페이지의 경우 기능이 중요하지 시각적요소가 깨지는것이 큰 문제가 되지 않을 가능성이 높기에 기능적 테스트만으로 충분하지만 B2C로 서비스되는 쇼핑몰과 같은 웹사이트에서 시각적 요소가 깨지는것은 사용자에게 좋지 않은 경험을 줄수 있으므로 이경우 시각적 테스트를 적용하는것이 좋습니다.

이때 스냅샷 테스트 VS 시각적 회귀 테스트를 고민할것입니다. 앞서 두가지를 설명할때 스냅샷 테스트의 단점을 부각한것같아 어느정도 눈치채셨을수 있지만, 개인적으로는 스냅샷 테스트 보다는 시각적 회귀 테스트를 사용하는것이 좋다고 생각합니다. 시각적 회귀 테스트가 스냅샷 테스트에 비해서 많은 비용이 들기는 하지만 스냅샷 테스트를 프로젝트내에 유지시켜두면 앞서 언급한 단점들로 인해 무용지물이 되는 경우가 많기 때문입니다.

테스트 코드를 작성하는 이유를 설명하고자 한다면 켄트 백이 이야기한 불안함을 지루함으로 바꾸는 과정이라는 말이 가장 적절하다고 생각합니다. 우리는 코드를 작성할때 이 코드가 의도대로 실행되지 않을까 하는 불안감을 지우고 자신감을 얻기위해 테스트 코드를 작성하는것이기 때문입니다. 따라서 앞서 중요한곳에만 사용하는것이 좋다는 E2E 테스트나, 시각적 회귀 테스트가 들이는 비용대비 많은 불안감을 제거해준다면 다른 테스트보다 많은 비중을 두고 사용할수도 있기때문에 제가 소개해드린 방법은 개인적으로 선호하는 한가지 전략 정도로 이해해주시고, 항상 이 테스트 코드가 줄여주는 불안감과 들어기는 비용을 고려하여 테스트 코드를 작성해보면 좋을것 같습니다.

일반적으로 단위 테스트를 통합테스트보다 많이 사용해야한다는 이야기를 들어보신적이 있으실것입니다. 이는 많이 알려진 테스트 피라미드에 근거한 이야기입니다. 하지만 테스트 피라미드의 창시자인 마틴파울러나 TDD의 저자 켄트백은 단위 테스트를 고립된 하위 모듈을 테스트 하는것이 아닌 상위 모듈을 통해 하위 모듈을 검증하는 방식을 지칭하였습니다 즉 우리가 생각하는 통합테스트를 이들은 단위테스트로 생각한것입니다. 따라서 앞서 보편적인 전략을 소개할때 통합테스트를 단위 테스트보다 우선시하여 소개한것입니다. 이에 대해 관심이 있으시다면 [마틴 파울러의 블로그 게시물](https://martinfowler.com/articles/2021-test-shapes.html)을 참고해보시면 좋을것 같습니다.