---
title: MSW(Mock Service Worker) - 2. API schema 생성 자동화 
date: 2025-01-25 01:00:00 +09:00
categories: [Fronte-End, MSW]
tags: [MSW, swaggerUI]
---

## **목적**

MSW를 적용하고 모의 데이터를 생성하기 위해서는 API의 형식에 맞는 데이터 구조로 만들어져야합니다. 그래서 그 형식을 사람이 일일히 지정해서 만들기에는 휴먼에러의 가능성과

수고로움이 있기에 이 과정을 자동화하려합니다.

이를 위해 swagger UI에서 제공하는 api docs를 이용하여, MSW와 stroybook에 사용가능한 mock API schema를 자동으로 생성합니다.

## **과정**

swagger UI에서 제공하는 api docs에 api를 호출하여 해당 api 경로에 스키마를 가져온다.

그리고 이를 브라우저에서 바로 활용하는 방식과 프로젝트에 파일로 저장하는 방식으로 제공합니다.

파일이 있는 경우는 따로 api docs 호출을 하지 않고 파일이 없는 경우는 api docs를 호출하여 모의 데이터를 생성합니다.

## **시행착오**

**swagger UI에서 제공하는 api docs에 api를 호출하여 해당 api 경로에 스키마를 가져온다.**

위에 작성된 이 부분이 문장으로는 참 간단하게 표현된 부분이지만, swagger UI의 api docs에서는 스키마를 바로 제공해주지 않습니다. 웹페이지 상에 있는 예시 또한 html 템플릿으로 적혀있는 것입니다.

응답에 대한 스키마는 아래와 같이 모델을 참조하는 방식으로 되어있기 때문에 이 부분을 어떻게 할 지 참 고민이 많았습니다. 그래서 생각한 방법은 크게 2가지였습니다.

1. Java 같은 모델형식을 프로젝트에 구현해서 가져온다.
2. Api response를 순환 참조한다.

두 방식 전부 마음에 들진 않았습니다. 그래도 1번 방식은 실제 백엔드 구조를 구현하는 것이기 때문에 리소스(시간, 인력)가 많이 필요할 것으로 생각되어서 2번 방식을 채택했습니다.

순환 참조를 하게 되면 복잡도가 최대 O(n^5)까지 예상이 되어서 이 방식을 하는게 맞는건가? 진짜 아닌 것 같다라는 생각이 들긴 했지만, n이 작고 다른 방법을 생각하지 못해서 작업을 시작했습니다.

그리하여, 최종적으로 api 스키마를 가져오는 것에 성공했고, 이와 더불어 swagger UI에 API들이 tag에 따라 분류되어있는 점을 참고해 tag를 입력하면 하위 api 스키마들을 개별 파일로 저장하는 기능을 추가했습니다.

그리고 개별 경로를 입력하여 파일을 저장하는 경우에는, 배열요소가 있으면 최대, 최소 갯수를 설정할 수 있는 기능 또한 추가했습니다.

![image.png](/assets/img/2025-01-25/2025-01-25-MSW_2_1.png)

![image.png](/assets/img/2025-01-25/2025-01-25-MSW_2_2.png)

![image.png](/assets/img/2025-01-25/2025-01-25-MSW_2_3.png)

![image.png](/assets/img/2025-01-25/2025-01-25-MSW_2_4.png)

![image.png](/assets/img/2025-01-25/2025-01-25-MSW_2_5.png)

![image.png](/assets/img/2025-01-25/2025-01-25-MSW_2_6.png)

## **고민사항**

모의 데이터이다보니 실제 데이터와는 달라 UI상에 나타나는 모습이 마음에 들지 않습니다. 그래서 실제 데이터를 저장해거나 DB나 혹은 비슷한 방식으로 이를 대체해볼까 생각중입니다.

그러나, 그렇게 되면 좀 더 보기에도 좋긴 하겠지만, 모의 데이터의 의의가 사라지진 않는가 싶기도 해서 보류 중입니다. 거의 안할 듯합니다.